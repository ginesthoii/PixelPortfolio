<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Arcade Tetris — Center Well + Block Outlines</title>
<style>
  :root{
    --cabinet-src: url('retro-game-machine.png');

    /* Wider CRT “box” area (percent of 600×600 image).
       Nudge these ±0.3% if needed to fit your PNG perfectly. */
    --crt-left: 20%;
    --crt-top: 24%;
    --crt-width: 60%;
    --crt-height: 40%;
  }

  html,body{
    height:100%; margin:0; background:#0b0d0e;
    display:grid; place-items:center;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    overscroll-behavior:none;
  }

  .cabinet{ position:relative; width:min(95vmin,1100px); }
  .cabinet img{
    display:block; width:100%; height:auto;
    filter: drop-shadow(0 24px 70px rgba(0,0,0,.6));
    user-select:none; -webkit-user-drag:none;
  }

  .crt-box{
    position:absolute; z-index:2;
    left:var(--crt-left); top:var(--crt-top);
    width:var(--crt-width); height:var(--crt-height);
    display:flex; justify-content:space-between; align-items:center;
    padding:8px;
    background:#072b27;
    border-radius:6px;
    box-sizing:border-box;
    overflow:hidden;
  }

  .sidebar{
    width:100px; color:#cfe; font-size:14px;
    display:flex; flex-direction:column; align-items:center;
    text-align:center; gap:8px;
  }
  .sidebar .title{ opacity:.85; letter-spacing:.03em }
  .stat{
    font-size:16px; background:rgba(0,0,0,.2);
    padding:.25rem .5rem; border-radius:.3rem; min-width:64px;
  }

  #crt{
    height:100%;
    width:auto;
    image-rendering:pixelated;
    background:#031b18;
    border-radius:4px;
    display:block;
  }

  .controls{
    position:absolute;
    left:50%; transform:translateX(-50%);
    bottom:2.2%;
    z-index:3;

    display:flex;
    flex-direction:column;
    align-items:center;
    gap:.4rem;

    background:rgba(0,0,0,.55);
    padding:.6rem 2rem;
    border-radius:.5rem;
    color:#cfe; text-align:center;
    min-width:380px;
    border:1px solid rgba(255,255,255,.18);
    box-shadow: 0 2px 12px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
  }
  .controls .button-row{
    display:flex; justify-content:center; gap:.6rem; flex-wrap:wrap;
  }
  .controls button{
    appearance:none;
    border:1px solid rgba(255,255,255,.25);
    background: rgba(255,255,255,.06);
    color:#e9ffff;
    padding:.4rem 1rem;
    border-radius:.35rem;
    font:13px/1 monospace;
    cursor:pointer;
  }
  .controls button:hover{ background: rgba(255,255,255,.15); }
  .controls .legend{ opacity:.85; font-size:11px }

  .overlay{
    position:absolute; inset:0; display:none; align-items:center; justify-content:center;
    background:rgba(0,0,0,.45); z-index:4; color:white; text-align:center;
  }
  .overlay.show{ display:flex; }
  .overlay .card{
    background: rgba(0,0,0,.7); padding:1rem 1.25rem; border:1px solid rgba(255,255,255,.25);
    border-radius:.5rem; min-width:220px;
  }
  .overlay h2{ margin:.25rem 0 .5rem; font-size:20px }
  .overlay p{ margin:.25rem 0; font-size:13px; opacity:.9 }

  @media (max-width: 900px){
    :root{ --crt-left: 8.2%; --crt-top:10.1%; --crt-width:83.6%; --crt-height:65.6%; }
    .controls{ bottom:2.8%; min-width:340px; }
  }
  @media (max-width: 700px){
    :root{ --crt-left: 8.4%; --crt-top:10.1%; --crt-width:83.0%; --crt-height:65.2%; }
    .controls{ bottom:3.2%; min-width:310px; }
  }
</style>
</head>
<body>
  <div class="cabinet">
    <img id="cab-img" alt="Arcade cabinet">

    <div class="crt-box">
      <div class="sidebar">
        <div class="title">SCORE</div>
        <div class="stat" id="score">0</div>
        <div class="title" style="margin-top:.4rem;">LINES</div>
        <div class="stat" id="lines">0</div>
        <div class="title" style="margin-top:.4rem;">HI</div>
        <div class="stat" id="highScore">0</div>
      </div>

      <canvas id="crt" width="320" height="640"></canvas>

      <div class="sidebar">
        <div class="title">NEXT</div>
        <canvas id="next" width="64" height="64"
                style="background:rgba(0,0,0,.2); border-radius:.25rem;"></canvas>
        <div class="title" style="margin-top:.4rem;">LEVEL</div>
        <div class="stat" id="level">1</div>
      </div>
    </div>

    <!-- Overlays -->
    <div id="pauseOverlay" class="overlay">
      <div class="card">
        <h2>Paused</h2>
        <p>Press <b>P</b>, click outside this card, or hit <b>Resume</b>.</p>
        <button id="resumeBtn">Resume</button>
      </div>
    </div>

    <div id="gameOverOverlay" class="overlay"><div class="card">
      <h2>Game Over</h2>
      <p>Press <b>R</b> or click <b>Restart</b>.</p>
    </div></div>

    <!-- Controls -->
    <div class="controls">
      <div class="button-row">
        <button id="restartBtn">Restart</button>
        <button id="pauseBtn">Pause</button>
        <button id="dropBtn">Hard Drop</button>
      </div>
      <span class="legend">
        Keys: ← → move · ↑ rotate · ↓ soft · Space hard · P pause · R restart
      </span>
    </div>
  </div>

<script>
(() => {
  const url = getComputedStyle(document.documentElement)
    .getPropertyValue('--cabinet-src').trim().replace(/^url\(["']?/, '').replace(/["']?\)$/, '');
  document.getElementById('cab-img').src = url;
})();

const cv = document.getElementById('crt'), ctx = cv.getContext('2d');
const nextCv = document.getElementById('next'), nextCtx = nextCv.getContext('2d');
const COLS = 10, ROWS = 20, CELL = 32;
cv.width  = COLS * CELL; cv.height = ROWS * CELL;

const COLORS = { I:'#00e5ff', O:'#ffd400', T:'#b565ff', S:'#00c853',
                 Z:'#ff5252', J:'#2979ff', L:'#ff9100' };
const SHAPES = {
  I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],
  J:[[1,0,0],[1,1,1],[0,0,0]],
  L:[[0,0,1],[1,1,1],[0,0,0]],
  O:[[1,1],[1,1]],
  S:[[0,1,1],[1,1,0],[0,0,0]],
  Z:[[1,1,0],[0,1,1],[0,0,0]],
  T:[[0,1,0],[1,1,1],[0,0,0]]
};

let PF, bag, p, nextP;
let score, lines, level, over=false, paused=false;
let baseDrop=550, acc=0, last=0;

function initGame(){
  PF = Array.from({length: ROWS}, () => Array(COLS).fill(0));
  bag = []; score=0; lines=0; level=1; over=false; paused=false;
  document.getElementById('score').textContent=score;
  document.getElementById('lines').textContent=lines;
  document.getElementById('level').textContent=level;
  hideOverlay('pauseOverlay'); hideOverlay('gameOverOverlay');
  refillBag(); p=undefined; nextP=undefined; spawn();
  acc=0; last=0;
}

function refillBag(){
  const seq=['I','J','L','O','S','T','Z'];
  while(seq.length) bag.push(seq.splice(Math.random()*seq.length|0,1)[0]);
}
function nextPiece(){
  if(!bag.length) refillBag();
  const name=bag.pop(), matrix=SHAPES[name].map(r=>r.slice());
  const col=(COLS>>1)-Math.ceil(matrix[0].length/2);
  const row=(name==='I')?-1:-2;
  return {name,matrix,row,col};
}
function spawn(){ p=nextP||nextPiece(); nextP=nextPiece(); drawNext(); }

function rotate(m){ const N=m.length-1; return m.map((row,i)=>row.map((_,j)=>m[N-j][i])); }
function canPlace(m,r,c){
  for(let i=0;i<m.length;i++)for(let j=0;j<m[i].length;j++){
    if(!m[i][j])continue; const x=c+j,y=r+i;
    if(x<0||x>=COLS||y>=ROWS)return false;
    if(y>=0&&PF[y][x])return false;
  } return true;
}
function drawBlock(px,py,color){
  ctx.fillStyle=color; ctx.fillRect(px,py,CELL-1,CELL-1);
  ctx.strokeStyle='rgba(255,255,255,.9)'; ctx.lineWidth=1;
  ctx.strokeRect(px+0.5,py+0.5,CELL-2,CELL-2);
}

function applyLineClears(){
  let cleared=0;
  for(let r=ROWS-1;r>=0;){ if(PF[r].every(v=>!!v)){ PF.splice(r,1); PF.unshift(Array(COLS).fill(0)); cleared++; } else r--; }
  if(cleared){
    score+=[0,100,300,500,800][cleared]||cleared*100;
    lines+=cleared; level=Math.floor(lines/10)+1;
    document.getElementById('score').textContent=score;
    document.getElementById('lines').textContent=lines;
    document.getElementById('level').textContent=level;
    const key='tetrisHighScore';
    const hs=Math.max(Number(localStorage.getItem(key)||0),score);
    localStorage.setItem(key,hs); document.getElementById('highScore').textContent=hs;
  }
}
function lock(){
  for(let i=0;i<p.matrix.length;i++)for(let j=0;j<p.matrix[i].length;j++)
    if(p.matrix[i][j]){ const y=p.row+i,x=p.col+j; if(y<0){gameOver();return;} PF[y][x]=p.name; }
  applyLineClears(); spawn();
}
function drawNext(){
  nextCtx.clearRect(0,0,nextCv.width,nextCv.height);
  const m=nextP.matrix,color=COLORS[nextP.name],size=16,off=10;
  for(let i=0;i<m.length;i++)for(let j=0;j<m[i].length;j++)if(m[i][j]){
    nextCtx.fillStyle=color; nextCtx.fillRect(off+j*size,off+i*size,size-2,size-2);
    nextCtx.strokeStyle='rgba(255,255,255,.8)'; nextCtx.strokeRect(off+j*size+0.5,off+i*size+0.5,size-3,size-3);
  }
}
function hardDrop(){ if(over||paused)return; while(canPlace(p.matrix,p.row+1,p.col))p.row++; lock(); }
function togglePause(){
  if(over)return; paused=!paused;
  document.getElementById('pauseBtn').textContent=paused?'Resume':'Pause';
  setOverlay('pauseOverlay',paused);
}
function setOverlay(id,on){ document.getElementById(id).classList.toggle('show',!!on); }
function hideOverlay(id){ document.getElementById(id).classList.remove('show'); }
function gameOver(){
  over=true;
  const key='tetrisHighScore'; const hs=Math.max(Number(localStorage.getItem(key)||0),score);
  localStorage.setItem(key,hs); document.getElementById('highScore').textContent=hs;
  setOverlay('gameOverOverlay',true);
}
function currentDrop(){ return Math.max(120, baseDrop-(level-1)*35); }

function loop(ts){
  requestAnimationFrame(loop);
  if(!last) last=ts; const dt=ts-last; last=ts; if(!paused&&!over)acc+=dt;
  ctx.clearRect(0,0,cv.width,cv.height);
  ctx.fillStyle='#031b18'; ctx.fillRect(0,0,cv.width,cv.height);
  ctx.strokeStyle='#fff'; ctx.lineWidth=2; ctx.strokeRect(0.5,0.5,COLS*CELL-1,ROWS*CELL-1);
  for(let r=0;r<ROWS;r++)for(let c=0;c<COLS;c++)if(PF[r][c])drawBlock(c*CELL,r*CELL,COLORS[PF[r][c]]);
  while(acc>=currentDrop()&&!paused&&!over){ acc-=currentDrop(); const nr=p.row+1; if(!canPlace(p.matrix,nr,p.col))lock(); else p.row=nr; }
  if(!over){ for(let i=0;i<p.matrix.length;i++)for(let j=0;j<p.matrix[i].length;j++)if(p.matrix[i][j])drawBlock((p.col+j)*CELL,(p.row+i)*CELL,COLORS[p.name]); }
}
requestAnimationFrame(loop);

// Buttons
document.getElementById('restartBtn').addEventListener('click',()=>initGame());
document.getElementById('pauseBtn').addEventListener('click',togglePause);
document.getElementById('dropBtn').addEventListener('click',hardDrop);

// Resume overlay buttons/clicks
document.getElementById('resumeBtn').addEventListener('click',e=>{ e.stopPropagation(); togglePause(); });
document.getElementById('pauseOverlay').addEventListener('click',e=>{ if(e.target.id==='pauseOverlay')togglePause(); });

// Keyboard
window.addEventListener('keydown',e=>{
  const k=e.key;
  if(k.startsWith('Arrow'))e.preventDefault();
  if(over){ if(k==='r'||k==='R')initGame(); return; }
  if(k==='p'||k==='P'){ togglePause(); return; }
  if(paused)return;
  if(k===' '){ e.preventDefault(); hardDrop(); return; }
  if(k==='ArrowLeft'&&canPlace(p.matrix,p.row,p.col-1))p.col--;
  if(k==='ArrowRight'&&canPlace(p.matrix,p.row,p.col+1))p.col++;
  if(k==='ArrowUp'){ const m=rotate(p.matrix); if(canPlace(m,p.row,p.col))p.matrix=m; }
  if(k==='ArrowDown'){ const nr=p.row+1; if(!canPlace(p.matrix,nr,p.col))lock(); else p.row=nr; acc=0; }
});

// Boot
(function(){
  const key='tetrisHighScore'; const hs=Number(localStorage.getItem(key)||0);
  document.getElementById('highScore').textContent=hs;
  initGame();
})();
</script>
</body>
</html>
